<div class="qa-app-title">
  Trainee - Maintain CV
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 18px;">
  <div style="color: #004050">{{cvData?.fullName || '...'}}</div>
  <div style="margin-left: auto; color: #004050"><b>CV Status:</b> {{cvData?.status || '...'}}</div>
</div>

<form [formGroup]="cvForm" class="cv-content-wrapper">
  <section formGroupName="profile">
    <app-cv-card-base cardTitle="Personal Profile" [canComment]="canComment"
      [feedback]="cvData?.profile?.profileFeedback">
      <mat-form-field appearance="outline" class="w-100">
        <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="5" formControlName="profileDetails"
          name="profile-input" required></textarea>
      </mat-form-field>
    </app-cv-card-base>
  </section>

  <section formGroupName="hobbies">
    <app-cv-card-base cardTitle="Hobbies / Interests" [canComment]="canComment"
      [feedback]="cvData?.hobbies?.hobbiesFeedback">
      <mat-form-field appearance="outline" class="w-100">
        <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="5" formControlName="hobbiesDetails"
          name="hobbies-input" required></textarea>
      </mat-form-field>
    </app-cv-card-base>
  </section>

  <section formGroupName="skills">
    <app-cv-card-base [showOpenButton]="false" cardTitle="Skills">
      <mat-form-field appearance="outline" class="w-100" *ngFor="let cat of skillCategories">
        <mat-label>{{cat.label}}</mat-label>
        <mat-chip-list #chipList [attr.aria-label]="cat.label" [attr.name]="cat.key+'-chip-list'">
          <mat-chip *ngFor="let skill of cvForm.value.skills[cat.key]" [removable]="canEdit"
            (removed)="removeSkill(cat.key, skill)">
            {{skill}}
            <mat-icon *ngIf="canEdit" matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input [placeholder]="canEdit ? 'add more...' : ''" [matChipInputFor]="chipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="true"
            (matChipInputTokenEnd)="addSkill(cat.key, $event)" [name]="cat.key+'-skill-input'" [disabled]="!canEdit">
        </mat-chip-list>
      </mat-form-field>
    </app-cv-card-base>
  </section>

  <section>
    <app-cv-card-base #qualCard [feedback]="qualificationFeedback" [canComment]="canComment"
      (feedbackChange)="onQualificationFeedbackChange($event)" [showOpenButton]="false" cardTitle="Qualifications">
      <app-qualifications class="w-100" formControlName="allQualifications"
        (feedbackClick)="onQualificationFeedbackClick($event, qualCard)"></app-qualifications>
    </app-cv-card-base>
  </section>

  <section>
    <app-cv-card-base #expCard [feedback]="workExperienceFeedback" [canComment]="canComment"
      (feedbackChange)="onWorkExperienceFeedbackChange($event)" [showOpenButton]="false"
      cardTitle="Work Experience - QA">
      <app-work-experience class="w-100" formControlName="allWorkExperience"
        (feedbackClick)="onWorkExperienceFeedbackClick($event, expCard)"></app-work-experience>
    </app-cv-card-base>
  </section>

  <section>
    <app-cv-card-base #otherExpCard [feedback]="otherWorkExperienceFeedback" [canComment]="canComment"
      (feedbackChange)="onOtherWorkExperienceFeedbackChange($event)" [showOpenButton]="false"
      cardTitle="Work Experience - Other">
      <app-work-experience class="w-100" formControlName="otherWorkExperience"
        (feedbackClick)="onOtherWorkExperienceFeedbackClick($event, otherExpCard)"></app-work-experience>
    </app-cv-card-base>
  </section>
</form>

<div class="button-row" *ngIf="cvData">
  <div *ngIf="isTraineeView"
    style="width: 50%; display:flex; flex-direction: row; justify-content: left; align-items: center">
    <button *ngIf="!canComment && cvData.status !== 'Approved'" mat-flat-button color="primary" (click)="onCvSave()"
      title="Save all Changes" [disabled]="!cvData || cvData?.status==='For Review'">Save
    </button>
    <div *ngIf="!canComment" style="margin-right: 20px"></div>
    <button *ngIf="!canComment && allDetailsEntered() && cvData.status !== 'Approved'" mat-flat-button color="primary"
      (click)="openDialog()" title="Submit for Review" [disabled]="!cvData || cvData.status==='For Review'">Submit
    </button>


    <button *ngIf="cvData.status === 'Approved' && isTraineeView" mat-flat-button color="primary"
      (click)="onInitialiseNewCv()" title="Create New Cv">
      New CV
    </button>
    <mat-checkbox *ngIf="cvData.status === 'Approved' && isTraineeView" style="margin-left: 15px;"
      aria-label="Use current CV as template" label="Use current CV as template" labelPosition="after" color="primary"
      [ngModel]="useExistingCvAsTemplate" [value]="useExistingCvAsTemplate"
      (change)="onUseExistingCvAsTemplateChanged()">Use current CV as template
    </mat-checkbox>
  </div>

  <div *ngIf="!isTraineeView"
    style="width: 50%; display:flex; flex-direction: row; justify-content: left; align-items: center">
    <button *ngIf="canComment && cvData.status !== 'Approved'" mat-flat-button color="primary" (click)="onCvApproved()"
      title="Approve Cv"
      [disabled]="!cvData || cvData.status==='In Progress' || cvData.status === 'Failed Review' || !cvData.status">
      Approve
    </button>
    <div *ngIf="canComment" style="margin-right: 20px"></div>
    <button *ngIf="canComment  && cvData.status !== 'Approved'" mat-flat-button color="primary"
      (click)="onCvFailedReview()" title="Fail Cv"
      [disabled]="!cvData || cvData.status==='In Progress' || !cvData.status || cvData.status === 'Failed Review'">
      Fail
    </button>
  </div>

  <button style="margin-left: auto;" mat-flat-button color="primary" (click)="onDisplayPdf()" title="Open PDF"
    [disabled]="!cvData || cvForm.invalid">View PDF
  </button>
</div>

<app-spinner-overlay [show]="loadingData" fadeBg="true"></app-spinner-overlay>